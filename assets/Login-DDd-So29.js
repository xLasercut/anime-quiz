import{v as C,L as i,d as V,u as A,a as R,r as N,o as O,c as U,w as e,V as L,i as v,b as w,s as r,R as $,C as f,S as I,e as b,f as t,g as u,h as d,j as y,k as H,_ as j,l as S,t as k,m as x,n as z,p as B,q as P}from"./index-BT2ZsoMq.js";const M="https://discord.com/oauth2/authorize";function q(){const c=C(),s=["client_id=1133103250929877063","scope=identify","response_type=code",`redirect_uri=${encodeURIComponent("https://anime-quiz.lasercut.dev/login")}`,`state=${c}`,"prompt=none"];return localStorage[i.OAUTH_STATE]=c,`${M}?${s.join("&")}`}const D=B("h2",null,"Login",-1),F=V({__name:"Login",setup(c){const s=A(),T=R(),p=v(P.SYSTEM_NOTIFICATION),n=N(!1),_=w();function h(){if(!localStorage[i.GAME_SERVER]){p("error","Server URL not set");return}n.value=!0,window.location.href=q()}function E(){const l=new URLSearchParams(window.location.search),o=l.get("state"),a=l.get("code");if(a||(T.$reset(),s.$reset(),r.disconnect()),a&&o!==localStorage[i.OAUTH_STATE]){console.error("State mismatch"),window.location.href=$;return}if(a&&o===localStorage[i.OAUTH_STATE]){n.value=!0;const g={code:a,dataVersion:s.dataVersion,clientVersion:f};r.connect(),r.emit(I.AUTHORIZE_USER,g,m=>{n.value=!1,m?_.push("/lobby"):(r.disconnect(),_.push("/login"))})}}return O(()=>{E()}),(l,o)=>(b(),U(L,{variant:"flat"},{default:e(()=>[t(y,null,{default:e(()=>[t(u,{justify:"center"},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>[D]),_:1})]),_:1})]),_:1}),t(z,null,{default:e(()=>[t(H,{fluid:!0},{default:e(()=>[t(u,{justify:"center","no-gutters":""},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>[t(j,{icon:"mdi-login",color:"success",onClick:o[0]||(o[0]=a=>h()),disabled:n.value},{default:e(()=>[S(" login via discord ")]),_:1},8,["disabled"])]),_:1})]),_:1}),t(u,{dense:!0},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>[S(" Client Version: "+k(x(f)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{F as default};
