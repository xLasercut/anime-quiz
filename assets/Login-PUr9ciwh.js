import{v as V,L as i,d as A,u as R,a as h,i as N,r as O,b as U,o as L,c as v,w as e,V as w,C as $,s as r,R as I,e as _,S as b,f as y,g as t,h as u,j as d,k as H,l as j,m as k,_ as x,n as S,t as z,p as B,q as P}from"./index-CfBULS3w.js";const M="https://discord.com/oauth2/authorize";function q(){const l=V(),s=["client_id=1133103250929877063","scope=identify","response_type=code",`redirect_uri=${encodeURIComponent("https://anime-quiz.lasercut.dev/login")}`,`state=${l}`,"prompt=none"];return localStorage[i.OAUTH_STATE]=l,`${M}?${s.join("&")}`}const G=A({__name:"Login",setup(l){const s=R(),T=h(),p=N($.SYSTEM_NOTIFICATION),n=O(!1),f=U();function E(){if(!localStorage[i.GAME_SERVER]){p("error","Server URL not set");return}n.value=!0,window.location.href=q()}function g(){const c=new URLSearchParams(window.location.search),o=c.get("state"),a=c.get("code");if(a||(T.$reset(),s.$reset(),r.disconnect()),a&&o!==localStorage[i.OAUTH_STATE]){console.error("State mismatch"),window.location.href=I;return}if(a&&o===localStorage[i.OAUTH_STATE]){n.value=!0;const m={code:a,dataVersion:s.dataVersion,clientVersion:_};r.connect(),r.emit(b.AUTHORIZE_USER,m,C=>{n.value=!1,C?f.push("/lobby"):(r.disconnect(),f.push("/login"))})}}return L(()=>{g()}),(c,o)=>(y(),v(w,{variant:"flat"},{default:e(()=>[t(j,null,{default:e(()=>[t(u,{justify:"center"},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>o[1]||(o[1]=[H("h2",null,"Login",-1)])),_:1})]),_:1})]),_:1}),t(P,null,{default:e(()=>[t(k,{fluid:!0},{default:e(()=>[t(u,{justify:"center","no-gutters":""},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>[t(x,{icon:"mdi-login",color:"success",onClick:o[0]||(o[0]=a=>E()),disabled:n.value},{default:e(()=>o[2]||(o[2]=[S(" login via discord ")])),_:1},8,["disabled"])]),_:1})]),_:1}),t(u,{dense:!0},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>[S(" Client Version: "+z(B(_)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{G as default};
