import{v as V,L as i,d as A,u as R,a as h,r as N,o as O,c as U,w as e,V as L,s as r,R as v,S as w,C as f,b as $,e as I,f as t,g as u,h as d,i as b,j as y,k as H,_ as j,l as S,t as k,m as x,n as z,p as B,q as P}from"./index-BQ0TV-HT.js";const M="https://discord.com/oauth2/authorize";function q(){const l=V(),s=["client_id=1133103250929877063","scope=identify","response_type=code",`redirect_uri=${encodeURIComponent("https://anime-quiz.lasercut.dev/login")}`,`state=${l}`,"prompt=none"];return localStorage[i.OAUTH_STATE]=l,`${M}?${s.join("&")}`}const G=A({__name:"Login",setup(l){const s=R(),T=h(),p=B(P.SYSTEM_NOTIFICATION),n=N(!1),_=$();function E(){if(!localStorage[i.GAME_SERVER]){p("error","Server URL not set");return}n.value=!0,window.location.href=q()}function g(){const c=new URLSearchParams(window.location.search),o=c.get("state"),a=c.get("code");if(a||(T.$reset(),s.$reset(),r.disconnect()),a&&o!==localStorage[i.OAUTH_STATE]){console.error("State mismatch"),window.location.href=v;return}if(a&&o===localStorage[i.OAUTH_STATE]){n.value=!0;const m={code:a,dataVersion:s.dataVersion,clientVersion:f};r.connect(),r.emit(w.AUTHORIZE_USER,m,C=>{n.value=!1,C?_.push("/lobby"):(r.disconnect(),_.push("/login"))})}}return O(()=>{g()}),(c,o)=>(I(),U(L,{variant:"flat"},{default:e(()=>[t(y,null,{default:e(()=>[t(u,{justify:"center"},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>o[1]||(o[1]=[b("h2",null,"Login",-1)])),_:1,__:[1]})]),_:1})]),_:1}),t(z,null,{default:e(()=>[t(H,{fluid:!0},{default:e(()=>[t(u,{justify:"center","no-gutters":""},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>[t(j,{icon:"mdi-login",color:"success",onClick:o[0]||(o[0]=a=>E()),disabled:n.value},{default:e(()=>o[2]||(o[2]=[S(" login via discord ")])),_:1,__:[2]},8,["disabled"])]),_:1})]),_:1}),t(u,{dense:!0},{default:e(()=>[t(d,{cols:"auto"},{default:e(()=>[S(" Client Version: "+k(x(f)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});export{G as default};
